<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Set theme color -->
  <meta name="theme-color" content="#74ebd5" />
  <title>Whack Angy Diggy</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(to right, #74ebd5, #ACB6E5);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    #scoreBoard, #levelDisplay, #timer {
      font-size: 24px;
      margin: 10px;
      color: #333;
    }
    #gameContainer {
      position: relative;
      width: 600px;
      height: 400px;
      background-color: #fff;
      border: 3px solid #333;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    /* Enlarged target styling: 100px by 100px */
    #target {
      position: absolute;
      width: 100px;
      height: 100px;
      background-color: #FF6F61;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    }
    #gameOverMessage {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 36px;
      color: #FF6F61;
      text-align: center;
    }
  </style>

  <!-- Dynamically create and inject the manifest -->
  <script>
    const manifest = {
      "short_name": "LCGame",
      "name": "Whack Angy Diggy",
      "icons": [
        {
          "src": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAI7SURBVHhe7d0xDsJgEATB9Z///E4iqJkyfUMPSB6VwTXOv+xDV6jrn+L5rwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAw8I/wPheZPNC8k2wAAAABJRU5ErkJggg==",
          "sizes": "192x192",
          "type": "image/png"
        },
        {
          "src": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAI7SURBVHhe7d0xDsJgEATB9Z///E4iqJkyfUMPSB6VwTXOv+xDV6jrn+L5rwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAwcHAw8I/wPheZPNC8k2wAAAABJRU5ErkJggg==",
          "sizes": "512x512",
          "type": "image/png"
        }
      ],
      "start_url": ".",
      "background_color": "#ffffff",
      "display": "standalone",
      "scope": ".",
      "theme_color": "#74ebd5"
    };
    const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
    const manifestURL = URL.createObjectURL(manifestBlob);
    const manifestLink = document.createElement('link');
    manifestLink.rel = 'manifest';
    manifestLink.href = manifestURL;
    document.head.appendChild(manifestLink);
  </script>

  <!-- Create and register the service worker from inline code -->
  <script>
    const swCode = `
      const CACHE_NAME = 'lcgame-cache-v1';
      const assetsToCache = ['./', './index.html', './AngyDiggy.png'];
      self.addEventListener('install', event => {
        event.waitUntil(
          caches.open(CACHE_NAME).then(cache => cache.addAll(assetsToCache))
        );
      });
      self.addEventListener('fetch', event => {
        event.respondWith(
          caches.match(event.request).then(response => response || fetch(event.request))
        );
      });
      self.addEventListener('activate', event => {
        event.waitUntil(
          caches.keys().then(keys => Promise.all(
            keys.filter(key => key !== CACHE_NAME).map(key => caches.delete(key))
          ))
        );
      });
    `;
    const swBlob = new Blob([swCode], { type: 'text/javascript' });
    const swUrl = URL.createObjectURL(swBlob);
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register(swUrl)
      .then(reg => console.log('Service Worker registered:', reg))
      .catch(err => console.error('Service Worker registration failed:', err));
    }
  </script>
</head>
<body>
  <h1>Whack Angy Diggy</h1>
  <div id="scoreBoard">Score: 0</div>
  <div id="levelDisplay">Level: 1</div>
  <div id="timer">Time: 60s</div>
  <div id="gameContainer">
    <div id="target"></div>
    <div id="gameOverMessage">
      Game Over!<br />
      Your score: <span id="finalScore"></span>
    </div>
  </div>

  <script>
    // Game variables
    let score = 0;
    let timeLeft = 60; // Game duration in seconds (1 minute)
    let level = 1;
    const levelThreshold = 10; // Increase level every 10 points
    let targetType = "red"; // "red" or "angy"
    let autoTimeoutId; // Used for auto-hiding the target

    const target = document.getElementById('target');
    const scoreBoard = document.getElementById('scoreBoard');
    const levelDisplay = document.getElementById('levelDisplay');
    const timerDisplay = document.getElementById('timer');
    const gameContainer = document.getElementById('gameContainer');
    const gameOverMessage = document.getElementById('gameOverMessage');
    const finalScoreDisplay = document.getElementById('finalScore');

    // Position the target within the container boundaries
    function positionElement(element) {
      const containerWidth = gameContainer.clientWidth;
      const containerHeight = gameContainer.clientHeight;
      const elemSize = element.clientWidth;
      const maxLeft = containerWidth - elemSize;
      const maxTop = containerHeight - elemSize;
      element.style.left = Math.floor(Math.random() * maxLeft) + 'px';
      element.style.top = Math.floor(Math.random() * maxTop) + 'px';
    }

    // Randomly choose the target type, update its style, and start the auto-hide timer
    function moveTarget() {
      // Clear any previous auto-hide timer
      if (autoTimeoutId) clearTimeout(autoTimeoutId);
      // Ensure the target is visible
      target.style.display = "block";
      // Randomly choose target type: red circle (penalty) or AngyDiggy image (reward)
      if (Math.random() < 0.5) {
        targetType = "red";
        target.style.backgroundColor = "#FF6F61";
        target.style.backgroundImage = "";
        target.style.borderRadius = "50%";
      } else {
        targetType = "angy";
        target.style.backgroundImage = "url('AngyDiggy.png')";
        target.style.backgroundSize = "cover";
        target.style.backgroundColor = "transparent";
        target.style.borderRadius = "0";
      }
      // Position the target randomly
      positionElement(target);
      // Auto-hide the target after 0.5 seconds and immediately display a new one
      autoTimeoutId = setTimeout(() => {
        target.style.display = "none";
        moveTarget();
      }, 500);
    }

    function updateLevel() {
      const newLevel = Math.floor(score / levelThreshold) + 1;
      if (newLevel !== level) {
        level = newLevel;
        levelDisplay.textContent = 'Level: ' + level;
      }
    }

    function updateTimer() {
      timeLeft--;
      timerDisplay.textContent = 'Time: ' + timeLeft + 's';
      if (timeLeft <= 0) {
        clearInterval(gameTimer);
        endGame();
      }
    }

    function endGame() {
      target.style.display = 'none';
      gameOverMessage.style.display = 'block';
      finalScoreDisplay.textContent = score;
    }

    // When the target is clicked, cancel the auto-hide timer, update the score based on its type, and reset the target
    target.addEventListener('click', () => {
      if (timeLeft > 0) {
        if (autoTimeoutId) clearTimeout(autoTimeoutId);
        if (targetType === "angy") {
          score++;
        } else { // red circle
          score--;
        }
        scoreBoard.textContent = 'Score: ' + score;
        updateLevel();
        moveTarget();
      }
    });

    // Start the game
    moveTarget();
    const gameTimer = setInterval(updateTimer, 1000);
  </script>
</body>
</html>
